define(['ko','jquery','underscore','mage/template','Magento_Catalog/js/price-utils','Magento_Ui/js/lib/knockout/template/loader','mage/translate','jquery/ui','Magento_Search/js/form-mini'],function(ko,$,_,mageTemplate,priceUtil,templateLoader,$t){'use strict';return function(widget){$.widget('smileEs.quickSearch',widget,{_onPropertyChange:_.debounce(function(){var searchField=this.element,clonePosition={position:'absolute',width:searchField.outerWidth()},value=_.escape(this.element.val());this.submitBtn.disabled=this._isEmpty(value);if(value.length>=parseInt(this.options.minSearchLength,10)){setTimeout(function(){this.searchForm.addClass('processing');this._updateAriaHasPopup(true);this.element.attr('aria-expanded','true');$('.search-autocomplete').attr('aria-hidden','false');}.bind(this),200);this.currentRequest=$.ajax({method:"GET",url:this.options.url,data:{q:value,form_key:$.mage.cookies.get('form_key')},beforeSend:function(){if(this.currentRequest!==null){this.currentRequest.abort();}}.bind(this),success:$.proxy(function(data){var self=this;var content=this._getResultWrapper();$.each(this._getSearchOverlayTabs(),function(index,element){$(element).empty();}.bind(this));$('h3.result-message').remove();if(data.length){var resultsMessage=$t("Search results for: '%1'").replace("%1",value);this.searchForm.addClass('has-results');$('body').addClass('search-has-results');$('<h3 class="result-message u-text-center" role="alert" aria-live="assertive">'
+resultsMessage.trim()+'</h3>').insertAfter('.js-search-autocomplete-clear');}
else{this.searchForm.removeClass('has-results');$('body').removeClass('search-has-results');}
var tabs=this._getAllTabs();$.each(tabs,function(index,tab){var tabElements=this._getSearchResultByType(data,tab.type);var counterSlot=$(tab.search_counter_selector);var tabElementCount=$(tabElements).length;var searchTitle=counterSlot.closest('.search-autocomplete__title');var noResultsMessage;if(tabElementCount>=1){var searchResultSlot=$(tab.search_result_selector);var tabLabel=searchTitle.find('.search-autocomplete__label').text().trim();var ariaLable=null;var firstElement=null;var lastElement=null;$.each(tabElements,function(index,element){var elementHtml=this._renderItem(element,index);searchResultSlot.append(elementHtml);if(firstElement==null){firstElement=element;}
lastElement=element;}.bind(this));var headerHtml=this._getSectionHeader(firstElement.type,data);searchResultSlot.prepend(headerHtml);if(firstElement.size){counterSlot.text('('+firstElement.size+')');}
if(tabElementCount>1){var footerHtml=this._renderFooter(lastElement,index);searchResultSlot.append(footerHtml);}
ariaLable=$t('Found %1 %2').replace('%1',firstElement.size).replace('%2',tabLabel);searchTitle.attr('aria-label',ariaLable);this.searchForm.removeClass('not-found');}
else{counterSlot.text('(0)');var searchResultSlot=$(tab.search_result_selector);if(tab.type==='product'||data.length===0){noResultsMessage=$t('Sorry, we couldn\'t find any product for %1').replace('%1',value);}
else if(tab.type==='recipe'||data.length===0){noResultsMessage=$t('Sorry, we couldn\'t find any recipe for %1').replace('%1',value);}
else if(tab.type==='cms_page'||data.length===0){noResultsMessage=$t('Sorry, we couldn\'t find any result for %1').replace('%1',value);}
else if(tab.type==='blog'||data.length===0){noResultsMessage=$t('Sorry, we couldn\'t find any press release for %1').replace('%1',value);}
searchResultSlot.html('<h3 class="no-result u-text-center" role="alert" aria-live="assertive">'
+noResultsMessage+'</h3>');searchTitle.attr('aria-label',noResultsMessage);this.searchForm.addClass('not-found');}}.bind(this));var activeTab=$(".search-autocomplete__title.active");var searchCategoryName=$.trim($(activeTab).find('.search-autocomplete__label').text());window.dataLayer=window.dataLayer||[];window.dataLayer.push({"event":"view_search_results","event_category":"engagement","search_query":value,"search_category":searchCategoryName});this.responseList.indexList=this.autoComplete.html(content).css(clonePosition).show().find(this.options.responseFieldElements+':visible');this._resetResponseList(false);this.element.removeAttr('aria-activedescendant');},this),complete:$.proxy(function(){this.searchForm.removeClass('processing');},this)});}else{this._resetResponseList(true);this.element.removeAttr('aria-activedescendant');this.searchForm.removeClass('has-results');this.searchForm.removeClass('not-found');$('body').removeClass('search-has-results');this._updateAriaHasPopup(false);this.element.attr('aria-expanded','false');$('.search-autocomplete').attr('aria-hidden','true');}},250),});$('.search-autocomplete__title').on('click',function(){var searchCategory=$.trim($(this).find('.search-autocomplete__label').text());window.dataLayer=window.dataLayer||[];window.dataLayer.push({"event":"view_search_results","event_category":"engagement","search_query":$("#search").val(),"search_category":searchCategory});});return $.smileEs.quickSearch;}});